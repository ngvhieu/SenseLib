@model IEnumerable<SenseLib.Models.SystemConfig>

@{
    ViewData["Title"] = "Quản lý cấu hình hệ thống";
    Layout = "_AdminLayout";
}

<section class="section dashboard">
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title">Danh sách cấu hình hệ thống</h5>
                        <a asp-action="Create" class="btn btn-primary">
                            <i class="bi bi-plus"></i> Thêm cấu hình mới
                        </a>
                    </div>

                    <div class="alert alert-info mb-4">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-info-circle-fill me-2 fs-5"></i>
                            <div>
                                <strong>Point là đơn vị tiền tệ được sử dụng trên hệ thống.</strong><br>
                                Người dùng có thể nhận Point khi đăng tài liệu được duyệt, hoặc từ các hoạt động khác trên hệ thống.
                                Point có thể được sử dụng để mua tài liệu trả phí, hoặc các dịch vụ khác.
                            </div>
                        </div>
                    </div>

                    @if (TempData["SuccessMessage"] != null)
                    {
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <i class="bi bi-check-circle me-1"></i>
                            @TempData["SuccessMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    }
                    
                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i class="bi bi-exclamation-triangle me-1"></i>
                            @TempData["ErrorMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    }
                    
                    <!-- Phần cấu hình Point -->
                    <div class="mb-4">
                        <h5 class="border-bottom pb-2 text-primary">
                            <i class="bi bi-coin me-2"></i>Cấu hình Point
                        </h5>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr class="table-primary">
                                        <th scope="col">Khóa cấu hình</th>
                                        <th scope="col">Giá trị</th>
                                        <th scope="col">Mô tả</th>
                                        <th scope="col">Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.Where(c => c.ConfigKey.Contains("Point") || c.Description.Contains("Point") || c.Description.Contains("point")))
                                    {
                                        <tr>
                                            <td><strong>@item.ConfigKey</strong></td>
                                            <td>
                                                <span class="badge bg-primary">@item.ConfigValue</span>
                                            </td>
                                            <td>@item.Description</td>
                                            <td>
                                                <div class="btn-group" role="group">
                                                    <a asp-action="Edit" asp-route-id="@item.ConfigID" class="btn btn-primary btn-sm">
                                                        <i class="bi bi-pencil"></i> Sửa
                                                    </a>
                                                    
                                                    <a asp-action="Details" asp-route-id="@item.ConfigID" class="btn btn-info btn-sm">
                                                        <i class="bi bi-info-circle"></i> Chi tiết
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Các cấu hình khác -->
                    <div>
                        <h5 class="border-bottom pb-2">
                            <i class="bi bi-gear me-2"></i>Cấu hình hệ thống khác
                        </h5>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover datatable">
                                <thead>
                                    <tr>
                                        <th scope="col">ID</th>
                                        <th scope="col">Khóa cấu hình</th>
                                        <th scope="col">Giá trị</th>
                                        <th scope="col">Mô tả</th>
                                        <th scope="col">Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.Where(c => !c.ConfigKey.Contains("Point") && !c.Description.Contains("Point") && !c.Description.Contains("point")))
                                    {
                                        <tr>
                                            <td>@item.ConfigID</td>
                                            <td>@item.ConfigKey</td>
                                            <td>@item.ConfigValue</td>
                                            <td>@item.Description</td>
                                            <td>
                                                <div class="btn-group" role="group">
                                                    <a asp-action="Edit" asp-route-id="@item.ConfigID" class="btn btn-primary btn-sm">
                                                        <i class="bi bi-pencil"></i>
                                                    </a>
                                                    
                                                    @{
                                                        string[] essentialConfigs = { "MaxLoginAttempts", "LockoutTimeMinutes", "HomePagePaidDocuments", "HomePageFreeDocuments", "PointsForApprovedDocument" };
                                                        bool isEssential = essentialConfigs.Contains(item.ConfigKey);
                                                    }
                                                    
                                                    <a asp-action="Details" asp-route-id="@item.ConfigID" class="btn btn-info btn-sm">
                                                        <i class="bi bi-info-circle"></i>
                                                    </a>
                                                    
                                                    @if (!isEssential)
                                                    {
                                                        <a asp-action="Delete" asp-route-id="@item.ConfigID" class="btn btn-danger btn-sm">
                                                            <i class="bi bi-trash"></i>
                                                        </a>
                                                    }
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('.datatable').DataTable({
                "language": {
                    "lengthMenu": "Hiển thị _MENU_ mục",
                    "zeroRecords": "Không tìm thấy dữ liệu",
                    "info": "Hiển thị _START_ đến _END_ của _TOTAL_ mục",
                    "infoEmpty": "Không có dữ liệu",
                    "infoFiltered": "(lọc từ _MAX_ mục)",
                    "search": "Tìm kiếm:",
                    "paginate": {
                        "first": "Đầu",
                        "last": "Cuối",
                        "next": "Sau",
                        "previous": "Trước"
                    }
                }
            });
        });
    </script>
} 