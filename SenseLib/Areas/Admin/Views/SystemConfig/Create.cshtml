@model SenseLib.Models.SystemConfig

@{
    ViewData["Title"] = "Thêm cấu hình mới";
    Layout = "_AdminLayout";
}

<section class="section dashboard">
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Thông tin cấu hình mới</h5>
                    
                    <div class="alert alert-info mb-4">
                        <div class="d-flex">
                            <div class="me-3">
                                <i class="bi bi-info-circle-fill fs-3"></i>
                            </div>
                            <div>
                                <strong>Lưu ý khi tạo cấu hình mới</strong><br>
                                <ul class="mb-0 ps-3">
                                    <li>Nếu tạo cấu hình liên quan đến Point, hãy bắt đầu khóa với tiền tố "Point" hoặc mô tả rõ liên quan đến Point.</li>
                                    <li>Đối với cấu hình Point, giá trị nên là số nguyên dương.</li>
                                    <li>Mô tả cấu hình càng chi tiết càng tốt để dễ hiểu và quản lý.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <form asp-action="Create" method="post" id="configForm">
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                        
                        <div class="row mb-3">
                            <label asp-for="ConfigKey" class="col-sm-2 col-form-label">Khóa cấu hình</label>
                            <div class="col-sm-10">
                                <div class="input-group">
                                    <input asp-for="ConfigKey" class="form-control" required id="configKey" placeholder="Nhập khóa cấu hình" />
                                    <button type="button" class="btn btn-outline-primary" id="btnAddPointPrefix">+ Point...</button>
                                </div>
                                <small class="text-muted">Ví dụ: PointsForLogin, PointsPerReview, HomePageItems...</small>
                                <span asp-validation-for="ConfigKey" class="text-danger"></span>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <label asp-for="ConfigValue" class="col-sm-2 col-form-label">Giá trị</label>
                            <div class="col-sm-10">
                                <div class="input-group">
                                    <input asp-for="ConfigValue" class="form-control" required placeholder="Nhập giá trị" id="configValue" />
                                    <span class="input-group-text d-none" id="pointSuffix">Point</span>
                                </div>
                                <span asp-validation-for="ConfigValue" class="text-danger"></span>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <label asp-for="Description" class="col-sm-2 col-form-label">Mô tả</label>
                            <div class="col-sm-10">
                                <textarea asp-for="Description" class="form-control" rows="3" placeholder="Mô tả chi tiết về cấu hình này..."></textarea>
                                <span asp-validation-for="Description" class="text-danger"></span>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-sm-10 offset-sm-2">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-save"></i> Lưu cấu hình
                                </button>
                                <a asp-action="Index" class="btn btn-secondary">
                                    <i class="bi bi-arrow-left"></i> Quay lại
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        $(document).ready(function() {
            // Xử lý khi nhấn nút thêm tiền tố Point
            $('#btnAddPointPrefix').click(function() {
                let currentValue = $('#configKey').val();
                if (!currentValue.startsWith('Point')) {
                    $('#configKey').val('Points' + currentValue);
                }
            });
            
            // Theo dõi sự thay đổi của configKey để hiển thị suffix Point nếu cần
            $('#configKey').on('input', function() {
                if ($(this).val().toLowerCase().includes('point')) {
                    $('#pointSuffix').removeClass('d-none');
                    
                    // Nếu giá trị hiện tại không phải số, set về 0
                    let currentVal = $('#configValue').val();
                    if (isNaN(currentVal) || currentVal === '') {
                        $('#configValue').val('0');
                    }
                    
                    // Chuyển input sang kiểu number
                    $('#configValue').attr('type', 'number').attr('min', '0');
                } else {
                    $('#pointSuffix').addClass('d-none');
                    $('#configValue').attr('type', 'text').removeAttr('min');
                }
            });
        });
    </script>
} 